<!DOCTYPE html>
<html>
<script defer src="https://cdn.jsdelivr.net/npm/web3@1.3.3/dist/web3.min.js"></script>
<script>
    // needs to run off a webserver (localhost etc), not as a file url
    window.addEventListener('load', async function (event) {
        if (typeof web3 !== 'undefined') {
            debugger;
            console.log('Web3 Detected! ' + web3.currentProvider.constructor.name)
            window.web3 = new Web3(web3.currentProvider);

            var registryAddress = "0x44691B39d1a75dC4E0A0346CBB15E310e6ED1E86";
            var registryABI = [{ "constant": false, "inputs": [{ "name": "_new", "type": "address" }], "name": "setOwner", "outputs": [], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "totalSignatures", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "owner", "outputs": [{ "name": "", "type": "address" }], "payable": false, "type": "function" }, { "constant": false, "inputs": [], "name": "drain", "outputs": [], "payable": false, "type": "function" }, { "constant": true, "inputs": [{ "name": "", "type": "bytes4" }], "name": "entries", "outputs": [{ "name": "", "type": "string" }], "payable": false, "type": "function" }, { "constant": false, "inputs": [{ "name": "_method", "type": "string" }], "name": "register", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "type": "function" }, { "inputs": [], "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "creator", "type": "address" }, { "indexed": true, "name": "signature", "type": "bytes4" }, { "indexed": false, "name": "method", "type": "string" }], "name": "Registered", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "name": "old", "type": "address" }, { "indexed": true, "name": "current", "type": "address" }], "name": "NewOwner", "type": "event" }];
            var registryCreationBlock = 2468384;
            var registry = new web3.eth.Contract(registryABI, registryAddress);

            var totalSignatures = await registry.methods.totalSignatures().call();

            console.log("totalSignatures: " + totalSignatures);

            var registeredEvent = registry.events.Registered({}, fromBlock: registryCreationBlock );
            var i = 0;
            // registeredEvent.watch(function (error, result) {
            //     // console.log(i++ + ": " + JSON.stringify(result));
            //     console.log(i++ + ": " + result.args.signature + " => " + result.args.method);
            // });
            registteredEvent.on("data", function(event) {
                console.log(event); // same results as the optional callback above
            })
        }
    })

</script>

<body>
</body>

</html>
